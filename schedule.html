<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Schedule — Louisiana Tech Wrestling Club</title>
  <!-- Favicons -->
  <link rel="icon" type="image/png" href="images/logo.png">
  <link rel="stylesheet" href="style.css">
  </head>

  <body>
    <header>
      <a href="index.html" class="logo-link" aria-label="Louisiana Tech Wrestling Club home">
          <img src="images/logo.png" alt="Louisiana Tech Wrestling Club Logo" width="242" height="110" class="site-logo">
      </a>
      <h1>Louisiana Tech Wrestling Club</h1>
    </header>

    <nav>
      <a href="index.html">Home</a>
      <a href="roster.html">Roster</a>
      <a href="media.html">Media</a>
      <a href="https://securelb.imodules.com/s/810/rd/interior.aspx?sid=810&gid=1&pgid=340&cid=860&fbclid=PAQ0xDSwKLRoBleHRuA2FlbQIxMAABp3GkFeeoOzfwpesyXBb843FHJxW2CbbCQPw-_DJmbvO_uewB3AKPbvQ1e7Ca_aem_VVdFMYP0s0ygTULpWLz3Wg" target="_blank" rel="noopener noreferrer">Support The Team</a>
      <a href="https://ncwa.net/teams/latu/" target="_blank" rel="noopener noreferrer">NCWA Team Page - Men</a>
      <a href="https://ncwa.net/teams/latuw/" target="_blank" rel="noopener noreferrer">NCWA Team Page - Women</a>
    </nav>

    <!-- Next match display (auto-populates from events on this page) -->
    <section id="next-match" class="next-match container" aria-label="Next match">
      <div class="match-left">
        <div class="match-logos">
          <img src="images/logo.png" alt="Louisiana Tech" class="match-logo team-logo" />
          <div class="match-at">at</div>
          <img src="" alt="Opponent" class="match-logo opp-logo" />
        </div>
        <div class="match-location">Location: <span id="match-location">TBD</span></div>
      </div>

      <div class="match-right">
        <div class="next-label">Next Match</div>
        <div class="next-datetime"><span id="next-date">TBD</span> / <strong id="next-time">TBD</strong></div>
        <div class="countdown" aria-live="polite">
          <div class="cd-box"><div id="cd-days">0</div><div class="cd-label">days</div></div>
          <div class="cd-box"><div id="cd-hours">0</div><div class="cd-label">hours</div></div>
          <div class="cd-box"><div id="cd-mins">0</div><div class="cd-label">Mins</div></div>
          <div class="cd-box"><div id="cd-secs">0</div><div class="cd-label">Secs</div></div>
        </div>
      </div>
    </section>

    <section id="stats-bar" class="stats-bar container" aria-label="Team Statistics">
      <div class="stat-box"><div class="stat-value" id="stat-overall">0-0</div><div class="stat-label">Overall</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-overall-pct">.000</div><div class="stat-label">Pct</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-conf">0-0</div><div class="stat-label">Conference</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-conf-pct">.000</div><div class="stat-label">Conf Pct</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-streak">—</div><div class="stat-label">Streak</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-home">0-0</div><div class="stat-label">Home</div></div>
      <div class="stat-box"><div class="stat-value" id="stat-away">0-0</div><div class="stat-label">Away</div></div>
    </section>

    <script>
      (function(){

        function parseResult(str) {
          if (!str) return null;
          const clean = str.trim().toUpperCase();
          if (clean.startsWith("W")) return "W";
          if (clean.startsWith("L")) return "L";
          return null;
        }

        function isHomeEvent(locationText) {
          return /home|ruston|lambright/i.test(locationText);
        }

        function updateStats() {
          const rows = Array.from(document.querySelectorAll('.event-row'));
          let overallW = 0, overallL = 0;
          let confW = 0, confL = 0;
          let homeW = 0, homeL = 0;
          let awayW = 0, awayL = 0;

          let streakArr = []; // chronological W/L for streak calculation

          rows.forEach((row) => {

            // ❌ Ignore tournaments completely
            const type = row.getAttribute('data-type') || "";
            if (type.toLowerCase() === "tournament") return;

            const result = parseResult(row.querySelector('.result-text')?.textContent || "");
            if (!result) return; // no score yet → skip

            const location = row.querySelector('.event-location')?.textContent || "";
            const isHome = isHomeEvent(location);
            const isAway = !isHome; // no neutral events in your system

            // Track streaks
            streakArr.push(result);

            // Overall
            if (result === "W") overallW++;
            if (result === "L") overallL++;

            // Conference (uses your explicit flag)
            const isConf = row.getAttribute("isConference") === "true";
            if (isConf) {
              if (result === "W") confW++;
              if (result === "L") confL++;
            }

            // Home / Away splits
            if (isHome) {
              if (result === "W") homeW++;
              if (result === "L") homeL++;
            } else if (isAway) {
              if (result === "W") awayW++;
              if (result === "L") awayL++;
            }
          });

          // Win percentage formatter
          function pct(w, l) {
            const total = w + l;
            if (total === 0) return ".000";
            return (w / total).toFixed(3).replace(/^0/, "");
          }

          // Build streak (W3, L2, etc.)
          let streak = "—";
          if (streakArr.length > 0) {
            let last = streakArr[streakArr.length - 1];
            let count = 1;
            for (let i = streakArr.length - 2; i >= 0; i--) {
              if (streakArr[i] === last) count++;
              else break;
            }
            streak = last + count;
          }

          // Update DOM
          document.getElementById('stat-overall').textContent = `${overallW}-${overallL}`;
          document.getElementById('stat-overall-pct').textContent = pct(overallW, overallL);
          document.getElementById('stat-conf').textContent = `${confW}-${confL}`;
          document.getElementById('stat-conf-pct').textContent = pct(confW, confL);
          document.getElementById('stat-streak').textContent = streak;
          document.getElementById('stat-home').textContent = `${homeW}-${homeL}`;
          document.getElementById('stat-away').textContent = `${awayW}-${awayL}`;
        }

        document.addEventListener('DOMContentLoaded', updateStats);

      })();
    </script>

  <main class="container schedule-fullwidth">
      <h2>2025-2026 Schedule</h2>
      <section class="schedule-table">
        <table id="schedule-table" class="event-list">
          <tbody>
            <tr class="event-row" data-logo="images/Lyon.webp" data-type="dual" isConference="false">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-11-15 · 10:00 AM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> Lyon College</div>
                  <div class="event-result" data-has-result="true">
                    <span class="result-text">W 26-23</span>
                  </div>
                </div>
                <div class="event-location">Batesville, AR</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/CBC.png" data-type="dual" isConference="false">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-11-15 · 11:15 AM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> Central Baptist College</div>
                  <div class="event-result" data-has-result="true">
                    <span class="result-text">L 24-20</span>
                  </div>
                </div>
                <div class="event-location">Batesville, AR</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/Auburn_Tigers_logo.svg.png" data-type="dual" isConference="false">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-12-06 · 1:00 PM CST</div>
                  <div class="event-title">Auburn University</div>
                  <div class="event-result" data-has-result="true">
                    <span class="result-text">W 31-4</span>
                  </div>
                </div>
                <div class="event-location">Home / Lambright Sports and Wellness Center</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/LSU_Athletics_logo.svg.png" data-type="dual" isConference="true">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-12-06 · 2:00 PM CST</div>
                  <div class="event-title">Louisiana State University</div>
                  <div class="event-result" data-has-result="true">
                    <span class="result-text">W 28-15</span>
                  </div>
                </div>
                <div class="event-location">Home / Lambright Sports and Wellness Center</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/Huntingdon.png" data-type="Tournament">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2026-01-04 · 9:00 AM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> Hawk Classic Open</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Montgomery, AL</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/logo.png" data-type="Tournament">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-01-10 · 10:00 AM CST</div>
                  <div class="event-title">Louisiana Tech Bulldog Rumble</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Home / Lambright Sports and Wellness Center</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/NOC.png" data-type="dual" isConference="false">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-01-17 · 10:00 AM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> Northern Oklahoma</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Clarksville, AR</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/ozarks.svg" data-type="dual" isConference="false">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-01-17 · 12:00 PM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> University of the Ozarks</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Clarksville, AR</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/famu.svg" data-type="Tournament">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-02-14 · 9:00 AM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> Seminole Rattler Invite</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Tallahasse, FL</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/logo.png" data-type="Tournament">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-02-21 · 10:00 AM CST</div>
                  <div class="event-title">LCWA State Championships</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Home / Lambright Sports and Wellness Center</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/Wayne_State_Wildcats_logo.svg.png" data-type="Tournament">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-03-14 · 9:00 AM CST</div>
                  <div class="event-title"><span class="away-pill">at</span> Southwest Conference Championships</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Wayne State College, NE</div>
              </td>
            </tr>

            <tr class="event-row" data-logo="images/NCWA.png" data-type="Tournament">
              <td class="event-cell">
                <div class="event-left">
                  <div class="event-meta">2025-03-26 - 2025-03-28 · 9:00 AM CST</div>
                  <div class="event-title">NCWA National Championships</div>
                  <div class="event-result" data-has-result="false">
                    <span class="result-text"></span>
                  </div>
                </div>
                <div class="event-location">Bossier City, LA</div>
              </td>
            </tr>

          </tbody>
        </table>
      </section>
    </main>

    <footer>
      &copy; 2025 Louisiana Tech Wrestling Club
    </footer>
  </footer>

    <!-- Auto-insert opponent logos from data-logo attribute -->
    <script>
    (function(){
      document.addEventListener('DOMContentLoaded', function(){
        document.querySelectorAll('.event-row').forEach(function(row){
          try{
            var logo = row.getAttribute('data-logo');
            var cellLeft = row.querySelector('.event-left');
            var eventCell = row.querySelector('.event-cell');
            // ensure a logo-slot exists (reserve space even if no logo)
            if(eventCell && !eventCell.querySelector('.logo-slot')){
              var slotDiv = document.createElement('div');
              slotDiv.className = 'logo-slot';
              eventCell.insertBefore(slotDiv, eventCell.firstChild);
            }
            if(!cellLeft) return;
            // if an <img.opponent-logo> already exists, skip
            if(cellLeft.querySelector('img.opponent-logo')) return;
            if(logo && logo.trim()){
              // move existing children into a text wrapper so layout stays stable
              var textWrap = document.createElement('div');
              textWrap.className = 'event-text';
              while(cellLeft.firstChild){
                textWrap.appendChild(cellLeft.firstChild);
              }
              // ensure a logo-slot exists inside the row's event-cell; create if missing
              var eventCell = row.querySelector('.event-cell');
              var slot = eventCell.querySelector('.logo-slot');
              if(!slot){
                slot = document.createElement('div');
                slot.className = 'logo-slot';
                eventCell.insertBefore(slot, eventCell.firstChild);
              }
              // append the text wrapper back so content remains visible
              cellLeft.appendChild(textWrap);

              // Move any .event-result out of the left text area into a right column
              try{
                var resultEl = textWrap.querySelector('.event-result');
                if(resultEl){
                  var right = eventCell.querySelector('.event-right');
                  if(!right){
                    right = document.createElement('div');
                    right.className = 'event-right';
                    // append the right column so it appears at the end of the row (after location)
                    eventCell.appendChild(right);
                  }
                  right.appendChild(resultEl);
                }
              }catch(e){ /* non-fatal */ }

              var img = document.createElement('img');
              img.className = 'opponent-logo';
              // wire load/error first
              img.onload = function(){
                // insert image into the reserved logo slot and switch layout
                slot.appendChild(img);
                cellLeft.classList.add('with-logo');
                row.classList.add('has-logo-rendered');
              };
              img.onerror = function(){
                // image failed to load; don't insert the broken <img>, let the CSS placeholder remain
                img.remove();
              };

              // set src (starts loading)
              img.src = logo.trim();
              // derive a sensible alt from the event title
              var titleEl = row.querySelector('.event-title');
              var titleText = titleEl ? titleEl.textContent.replace(/at\b/i,'').trim() : 'opponent';
              img.alt = titleText + ' logo';
            }
          }catch(e){ /* ignore individual row errors */ }
        });
      });
    })();
    </script>

    <script>
    (function(){
      // Next-match panel populating and countdown (runs after DOM ready)
      function pad(n){return String(n).padStart(2,'0');}
      const DEFAULT_TIME = '16:00';
      let target = null;

      function parseMetaDate(meta){
        // meta examples:
        // "2025-11-15 · 10:00 AM CST"
        // "2025-03-26 - 2025-03-28 · TBD"
        // "2025-12-06 · TBD"
        if(!meta) return null;
        // prefer the first full YYYY-MM-DD as the event start date (handles ranges)
        const dateMatch = meta.match(/(\d{4}-\d{2}-\d{2})/);
        if(!dateMatch) return null;
        const datePart = dateMatch[1];

        // attempt to extract the time portion after the '·' bullet if present
        const afterDot = meta.split('·')[1] || '';
        let timePart = afterDot.trim();

        // normalize common 'TBD' or empty times to the DEFAULT_TIME
        if(!timePart || /tbd/i.test(timePart)) timePart = DEFAULT_TIME;

        // Extract AM/PM explicitly (if present), then remove other stray timezone abbreviations
        // so we don't accidentally strip AM/PM (which are also short letter groups).
        const ampmMatch = timePart.match(/\b(am|pm)\b/i);
        const ampm = ampmMatch ? ampmMatch[1].toLowerCase() : null;
        // remove tokens that are likely timezone abbreviations but keep am/pm
        timePart = timePart.replace(/\b(?!am\b|pm\b)[A-Za-z]{2,4}\b/gi, '').trim();

        // handle formats like "10:00 AM" or "10 AM" or "14:30"
        let hour = null, minute = '00';
        const hhmm = timePart.match(/(\d{1,2}):(\d{2})/);
        if(hhmm){ hour = parseInt(hhmm[1],10); minute = hhmm[2]; }
        else{
          const hhOnly = timePart.match(/(\d{1,2})\b/);
          if(hhOnly){ hour = parseInt(hhOnly[1],10); }
        }

        // Apply AM/PM conversion if we detected it (or if it remained in timePart)
        const effectiveAMPM = ampm || (timePart.match(/\b(am|pm)\b/i) ? (timePart.match(/\b(am|pm)\b/i)[1].toLowerCase()) : null);
        if(hour !== null && effectiveAMPM){
          if(effectiveAMPM === 'pm' && hour < 12) hour += 12;
          if(effectiveAMPM === 'am' && hour === 12) hour = 0;
        }

        if(hour === null){
          // couldn't parse time; fall back to default
          const parts = DEFAULT_TIME.split(':'); hour = parseInt(parts[0],10); minute = parts[1];
        }

        // build an ISO-ish string to create a Date in the local timezone
        const hh = String(hour).padStart(2,'0');
        const mm = String(minute).padStart(2,'0');
        const iso = datePart + 'T' + hh + ':' + mm + ':00';
        const when = new Date(iso);
        return isNaN(when) ? null : when;
      }

      function findNextEvent(){
        const rows = Array.from(document.querySelectorAll('.event-row'));
        const now = new Date();
        let best = null;
        for(const r of rows){
          const meta = (r.querySelector('.event-meta') && r.querySelector('.event-meta').textContent) || '';
          const when = parseMetaDate(meta);
          if(!when) continue;
          if(when >= now){ if(!best || when < best.when) best = { el: r, when }; }
        }
        return best;
      }

      function updateCountdownElements(){
        if(!target) return;
        const now = new Date();
        const diff = Math.max(0, target - now);
        const days = Math.floor(diff/86400000);
        const hours = Math.floor(diff/3600000)%24;
        const mins = Math.floor(diff/60000)%60;
        const secs = Math.floor(diff/1000)%60;
        const daysEl = document.getElementById('cd-days');
        const hoursEl = document.getElementById('cd-hours');
        const minsEl = document.getElementById('cd-mins');
        const secsEl = document.getElementById('cd-secs');
        if(daysEl) daysEl.textContent = days;
        if(hoursEl) hoursEl.textContent = pad(hours);
        if(minsEl) minsEl.textContent = pad(mins);
        if(secsEl) secsEl.textContent = pad(secs);
      }

      function populatePanel(best){
        if(!best) return;
        target = best.when;
        const locEl = best.el.querySelector('.event-location');
        const loc = locEl ? locEl.textContent.trim() : '';
        const matchLocationEl = document.getElementById('match-location');
        if(matchLocationEl) matchLocationEl.textContent = loc.replace(/^Location:\s*/i,'') || loc;
        const dateEl = document.getElementById('next-date');
        const timeEl = document.getElementById('next-time');
        const opts = { month: 'short', day: 'numeric' };
        if(dateEl) dateEl.textContent = target.toLocaleDateString(undefined, opts);
        if(timeEl) timeEl.textContent = target.toLocaleTimeString(undefined, {hour:'numeric', minute:'2-digit'});

        const logo = best.el.getAttribute('data-logo') || '';
        const logos = document.querySelector('#next-match .match-logos');
        if(!logos) return;

        // Determine home/away more robustly:
        // - If the row explicitly has an .away-pill it's an away event.
        // - Otherwise, consider it home when the location contains typical home keywords.
        const hasAwayPill = !!best.el.querySelector('.away-pill');
        const locHomeMatch = /\b(home|ruston|lambright)\b/i.test(loc || '');
        const isHome = !hasAwayPill && locHomeMatch;

        // Derive opponent alt text from the event title where possible
        const titleEl = best.el.querySelector('.event-title');
        const titleText = titleEl ? titleEl.textContent.replace(/at\b/i,'').trim() : 'opponent';
        const oppAlt = titleText + ' logo';

        if(isHome){
          // Home: opponent logo at our logo
          logos.innerHTML = '<img src="'+(logo||'')+'" class="match-logo opp-logo" alt="'+oppAlt+'" /><div class="match-at">at</div><img src="images/logo.png" class="match-logo team-logo" alt="Louisiana Tech" />';
        } else {
          // Away (or unknown): our logo at opponent logo
          logos.innerHTML = '<img src="images/logo.png" class="match-logo team-logo" alt="Louisiana Tech" /><div class="match-at">at</div><img src="'+(logo||'')+'" class="match-logo opp-logo" alt="'+oppAlt+'" />';
        }
      }

      // run after DOMContentLoaded and after auto-insert has run
      document.addEventListener('DOMContentLoaded', function(){
        // small defer to ensure other DOM scripts (logo insertion) finished
        setTimeout(function(){
          const best = findNextEvent();
          if(best){ populatePanel(best); updateCountdownElements(); setInterval(updateCountdownElements, 1000); }
        }, 50);
      });

    })();
    </script>

  </body>
</html>
